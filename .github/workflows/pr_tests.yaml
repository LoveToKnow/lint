name: Lint & Tests

on: [pull_request]

jobs:
  lint_and_test:
    name: Unit Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎
        uses: actions/checkout@v2
      - name: Setup Node 14 💻
        uses: actions/setup-node@v1
        with:
          node-version: '14.x'
          registry-url: 'https://registry.npmjs.org'

      - name: Add CI PAT to npmrc file ✍🏽
        # secrets.GITHUB_TOKEN doesn't has access to other (private) repos.
        # so for `npm install`ing, we need a PAT
        run: echo "//npm.pkg.github.com/:_authToken=${{ secrets.PRIVATE_REPO_PAT }}" >> .npmrc

      - name: Install dependencies 📦
        run: npm install && npx lerna bootstrap

      - name: Lint 🧹
        run: npm run lint

      - name: Test 🔬
        run: npm run test
